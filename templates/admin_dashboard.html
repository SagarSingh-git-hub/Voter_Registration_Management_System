{% extends "base.html" %}

{% block content %}
<div class="relative min-h-screen pt-24 pb-12 px-6">
    <div class="max-w-7xl mx-auto">
        
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-end mb-10 slide-in-bottom">
            <div>
                <h2 class="font-display text-4xl md:text-5xl font-bold text-white mb-2">Admin Dashboard</h2>
                <div class="inline-flex items-center gap-3 mt-2 px-4 py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-md transition-all hover:bg-white/10 group cursor-default">
                    <div class="relative flex h-2.5 w-2.5">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald shadow-[0_0_8px_rgba(16,185,129,0.6)]"></span>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <span class="text-gray-400 font-medium">System Status</span>
                        <span class="w-px h-3 bg-white/10"></span>
                        <span class="text-emerald font-semibold tracking-wide flex items-center gap-1.5">
                            <i class="fas fa-shield-alt text-xs"></i>
                            Online & Secure
                        </span>
                    </div>
                </div>
            </div>
            <div class="flex gap-4 mt-4 md:mt-0">
                <a href="{{ url_for('admin.export_csv') }}" class="px-5 py-2.5 rounded-xl bg-dark/50 border border-glass-border text-gray-300 hover:text-white hover:border-electric/50 transition-all flex items-center gap-2 group">
                    <i class="fas fa-file-csv text-electric group-hover:scale-110 transition-transform"></i>
                    <span>Export CSV</span>
                </a>
                <a href="{{ url_for('admin.export_pdf') }}" class="px-5 py-2.5 rounded-xl bg-dark/50 border border-glass-border text-gray-300 hover:text-white hover:border-red-400/50 transition-all flex items-center gap-2 group">
                    <i class="fas fa-file-pdf text-red-400 group-hover:scale-110 transition-transform"></i>
                    <span>Export PDF</span>
                </a>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Sidebar (Filters) -->
            <div class="lg:col-span-3 space-y-6 slide-in-left" style="animation-delay: 0.1s;">
                <div class="glass-panel p-6 rounded-3xl sticky top-28">
                    <h3 class="font-display text-xl font-bold text-white mb-6 flex items-center gap-3">
                        <i class="fas fa-filter text-electric"></i> Filter Applications
                    </h3>
                    
                    <div class="space-y-3">
                        <a href="{{ url_for('admin.dashboard', _anchor='applications-table') }}" 
                           class="block px-5 py-4 rounded-xl transition-all duration-300 group relative overflow-hidden
                           {% if not request.args.get('status') %} bg-peacock/30 border border-electric/50 shadow-glow {% else %} bg-white/5 border border-transparent hover:bg-white/10 {% endif %}">
                            <div class="flex justify-between items-center relative z-10">
                                <span class="font-medium {% if not request.args.get('status') %} text-white {% else %} text-gray-400 group-hover:text-white {% endif %}">All Applications</span>
                                <span class="bg-dark/50 px-2 py-1 rounded-lg text-xs text-gray-400">{{ stats.total }}</span>
                            </div>
                            {% if not request.args.get('status') %}
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-electric shadow-glow"></div>
                            {% endif %}
                        </a>

                        <a href="{{ url_for('admin.dashboard', status='Pending', _anchor='applications-table') }}" 
                           class="block px-5 py-4 rounded-xl transition-all duration-300 group relative overflow-hidden
                           {% if request.args.get('status') == 'Pending' %} bg-peacock/30 border border-electric/50 shadow-glow {% else %} bg-white/5 border border-transparent hover:bg-white/10 {% endif %}">
                            <div class="flex justify-between items-center relative z-10">
                                <span class="font-medium {% if request.args.get('status') == 'Pending' %} text-white {% else %} text-gray-400 group-hover:text-white {% endif %}">Pending</span>
                                <i class="fas fa-clock text-electric animate-pulse-slow"></i>
                            </div>
                            {% if request.args.get('status') == 'Pending' %}
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-electric shadow-glow"></div>
                            {% endif %}
                        </a>

                        <a href="{{ url_for('admin.dashboard', status='Approved', _anchor='applications-table') }}" 
                           class="block px-5 py-4 rounded-xl transition-all duration-300 group relative overflow-hidden
                           {% if request.args.get('status') == 'Approved' %} bg-emerald/20 border border-emerald/50 shadow-glow-emerald {% else %} bg-white/5 border border-transparent hover:bg-white/10 {% endif %}">
                            <div class="flex justify-between items-center relative z-10">
                                <span class="font-medium {% if request.args.get('status') == 'Approved' %} text-white {% else %} text-gray-400 group-hover:text-white {% endif %}">Approved</span>
                                <i class="fas fa-check-circle text-emerald"></i>
                            </div>
                            {% if request.args.get('status') == 'Approved' %}
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-emerald shadow-glow-emerald"></div>
                            {% endif %}
                        </a>

                        <a href="{{ url_for('admin.dashboard', status='Rejected', _anchor='applications-table') }}" 
                           class="block px-5 py-4 rounded-xl transition-all duration-300 group relative overflow-hidden
                           {% if request.args.get('status') == 'Rejected' %} bg-red-500/10 border border-red-500/30 {% else %} bg-white/5 border border-transparent hover:bg-white/10 {% endif %}">
                            <div class="flex justify-between items-center relative z-10">
                                <span class="font-medium {% if request.args.get('status') == 'Rejected' %} text-white {% else %} text-gray-400 group-hover:text-white {% endif %}">Rejected</span>
                                <i class="fas fa-times-circle text-red-400"></i>
                            </div>
                            {% if request.args.get('status') == 'Rejected' %}
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-red-500"></div>
                            {% endif %}
                        </a>
                    </div>
                </div>


            </div>

            <!-- Main Content -->
            <div class="lg:col-span-9 space-y-8">
                
                <!-- 3D Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Total -->
                    <div class="glass-panel p-6 rounded-3xl tilt-card relative group cursor-default slide-in-bottom" style="animation-delay: 0.2s;">
                        <div class="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/5 flex items-center justify-center border border-white/10 group-hover:bg-electric/20 group-hover:border-electric/50 transition-all">
                            <i class="fas fa-users text-gray-400 group-hover:text-electric transition-colors"></i>
                        </div>
                        <h4 class="text-gray-400 text-sm font-medium uppercase tracking-wider mb-2">Total</h4>
                        <div class="text-4xl font-display font-bold text-white group-hover:text-glow transition-all">{{ stats.total }}</div>
                    </div>

                    <!-- Pending -->
                    <div class="glass-panel p-6 rounded-3xl tilt-card relative group cursor-default slide-in-bottom" style="animation-delay: 0.3s;">
                        <div class="absolute inset-0 bg-electric/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="absolute top-4 right-4 w-10 h-10 rounded-full bg-electric/10 flex items-center justify-center border border-electric/20 group-hover:bg-electric/30 transition-all">
                            <i class="fas fa-hourglass-half text-electric animate-pulse-slow"></i>
                        </div>
                        <h4 class="text-electric/80 text-sm font-medium uppercase tracking-wider mb-2">Pending</h4>
                        <div class="text-4xl font-display font-bold text-white group-hover:text-electric transition-all">{{ stats.pending }}</div>
                    </div>

                    <!-- Approved -->
                    <div class="glass-panel p-6 rounded-3xl tilt-card relative group cursor-default slide-in-bottom" style="animation-delay: 0.4s;">
                        <div class="absolute inset-0 bg-emerald/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="absolute top-4 right-4 w-10 h-10 rounded-full bg-emerald/10 flex items-center justify-center border border-emerald/20 group-hover:bg-emerald/30 transition-all">
                            <i class="fas fa-check text-emerald"></i>
                        </div>
                        <h4 class="text-emerald/80 text-sm font-medium uppercase tracking-wider mb-2">Approved</h4>
                        <div class="text-4xl font-display font-bold text-white group-hover:text-emerald transition-all">{{ stats.approved }}</div>
                    </div>

                    <!-- Rejected -->
                    <div class="glass-panel p-6 rounded-3xl tilt-card relative group cursor-default slide-in-bottom" style="animation-delay: 0.5s;">
                        <div class="absolute inset-0 bg-red-500/5 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        <div class="absolute top-4 right-4 w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center border border-red-500/20 group-hover:bg-red-500/30 transition-all">
                            <i class="fas fa-times text-red-400"></i>
                        </div>
                        <h4 class="text-red-400/80 text-sm font-medium uppercase tracking-wider mb-2">Rejected</h4>
                        <div class="text-4xl font-display font-bold text-white group-hover:text-red-400 transition-all">{{ stats.rejected }}</div>
                    </div>
                </div>

                <!-- Analytics Charts -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 slide-in-bottom" style="animation-delay: 0.55s;">
                    <div class="glass-panel p-6 rounded-3xl">
                        <h3 class="font-display text-lg font-bold text-white mb-4">Daily Registrations</h3>
                        <div class="relative h-64">
                            <canvas id="dailyChart"></canvas>
                        </div>
                    </div>
                    <div class="glass-panel p-6 rounded-3xl flex flex-col justify-between">
                        <h3 class="font-display text-lg font-bold text-white mb-4">Application Status Overview</h3>
                        
                        <div class="relative h-64 w-full flex items-center justify-center">
                            <canvas id="statusChart"></canvas>
                            <div class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none">
                                <span class="text-gray-400 text-xs font-medium uppercase tracking-wider mb-1">Total Applications</span>
                                <span class="text-4xl font-display font-bold text-white">{{ stats.total }}</span>
                            </div>
                        </div>

                        <!-- Custom Legend -->
                        <div class="mt-6 space-y-3">
                            <div class="flex justify-between items-center text-sm p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition-colors">
                                <div class="flex items-center gap-3">
                                    <span class="w-3 h-3 rounded-full bg-emerald shadow-[0_0_10px_rgba(16,185,129,0.5)]"></span>
                                    <span class="text-gray-300 font-medium">Approved</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-emerald font-bold">
                                        {% if stats.total > 0 %}{{ ((stats.approved / stats.total) * 100) | round | int }}%{% else %}0%{% endif %}
                                    </span>
                                    <span class="text-gray-500 font-mono">({{ stats.approved }})</span>
                                </div>
                            </div>
                            
                            <div class="flex justify-between items-center text-sm p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition-colors">
                                <div class="flex items-center gap-3">
                                    <span class="w-3 h-3 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"></span>
                                    <span class="text-gray-300 font-medium">Rejected</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-red-400 font-bold">
                                        {% if stats.total > 0 %}{{ ((stats.rejected / stats.total) * 100) | round | int }}%{% else %}0%{% endif %}
                                    </span>
                                    <span class="text-gray-500 font-mono">({{ stats.rejected }})</span>
                                </div>
                            </div>

                            {% if stats.pending > 0 %}
                            <div class="flex justify-between items-center text-sm p-3 rounded-xl bg-white/5 border border-white/5 hover:bg-white/10 transition-colors">
                                <div class="flex items-center gap-3">
                                    <span class="w-3 h-3 rounded-full bg-electric shadow-[0_0_10px_rgba(0,243,255,0.5)]"></span>
                                    <span class="text-gray-300 font-medium">Pending</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-electric font-bold">
                                        {% if stats.total > 0 %}{{ ((stats.pending / stats.total) * 100) | round | int }}%{% else %}0%{% endif %}
                                    </span>
                                    <span class="text-gray-500 font-mono">({{ stats.pending }})</span>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Admin Services / Quick Actions -->
                <div class="glass-panel p-6 rounded-3xl mb-8 slide-in-bottom" style="animation-delay: 0.56s;">
                     <h3 class="font-display text-xl font-bold text-white mb-6">Quick Actions (Voter Services)</h3>
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <a href="{{ url_for('voter.search_voter_page') }}" class="p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-electric/50 transition-all group flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-electric/10 text-electric flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i class="fas fa-search"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold text-sm">Search Voter List</h4>
                                <p class="text-xs text-gray-400">Find voter details</p>
                            </div>
                        </a>
                        
                        <a href="{{ url_for('voter.service_form', service_type='blo_call') }}" class="p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-emerald/50 transition-all group flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-emerald/10 text-emerald flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i class="fas fa-phone-alt"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold text-sm">Book BLO Call</h4>
                                <p class="text-xs text-gray-400">Schedule a call</p>
                            </div>
                        </a>

                        <a href="{{ url_for('voter.service_form', service_type='appeal') }}" class="p-4 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 hover:border-red-400/50 transition-all group flex items-center gap-4">
                            <div class="w-10 h-10 rounded-full bg-red-500/10 text-red-400 flex items-center justify-center group-hover:scale-110 transition-transform">
                                <i class="fas fa-gavel"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-bold text-sm">Submit Appeal</h4>
                                <p class="text-xs text-gray-400">File a new appeal</p>
                            </div>
                        </a>
                     </div>
                </div>

                <!-- Audit Logs -->
                <div class="glass-panel rounded-3xl overflow-hidden mb-8 slide-in-bottom" style="animation-delay: 0.58s;">
                    <div class="p-6 border-b border-glass-border">
                         <h3 class="font-display text-xl font-bold text-white">Audit Logs</h3>
                    </div>
                    <div class="max-h-60 overflow-y-auto custom-scrollbar overflow-x-auto">
                        <table class="w-full text-left min-w-[600px]">
                            <thead class="sticky top-0 bg-dark/95 backdrop-blur-md z-10">
                                <tr class="border-b border-glass-border">
                                     <th class="py-3 px-6 text-xs text-gray-400 font-semibold uppercase">Admin</th>
                                     <th class="py-3 px-6 text-xs text-gray-400 font-semibold uppercase">Action</th>
                                     <th class="py-3 px-6 text-xs text-gray-400 font-semibold uppercase">Details</th>
                                     <th class="py-3 px-6 text-xs text-gray-400 font-semibold uppercase">Time</th>
                                     <th class="py-3 px-6 text-xs text-gray-400 font-semibold uppercase">IP</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-glass-border">
                                {% for log in audit_logs %}
                                <tr class="text-sm hover:bg-white/5 transition-colors">
                                    <td class="py-3 px-6 text-white font-mono text-xs opacity-70">{{ log.admin_id }}</td>
                                    <td class="py-3 px-6 text-electric font-medium">{{ log.action }}</td>
                                    <td class="py-3 px-6 text-gray-400">{{ log.details }}</td>
                                    <td class="py-3 px-6 text-gray-500 text-xs">{{ log.timestamp.strftime('%H:%M:%S') }}</td>
                                    <td class="py-3 px-6 text-gray-500 font-mono text-xs">{{ log.ip_address }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="5" class="py-4 px-6 text-center text-gray-500">No logs available</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Applications Table -->
                <div id="applications-table" class="glass-panel rounded-3xl overflow-hidden slide-in-bottom" style="animation-delay: 0.6s;">
                    <div class="p-6 border-b border-glass-border flex justify-between items-center">
                        <h3 class="font-display text-xl font-bold text-white">Recent Applications</h3>
                        <div class="text-sm text-gray-400">Showing <span class="text-white font-bold">{{ applications|length }}</span> results</div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="bg-white/5 border-b border-glass-border">
                                    <th class="py-4 px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider">Applicant</th>
                                    <th class="py-4 px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider">ID Proof</th>
                                    <th class="py-4 px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider">EPIC No.</th>
                                    <th class="py-4 px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider">Status</th>
                                    <th class="py-4 px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider">Date</th>
                                    <th class="py-4 px-6 text-xs font-semibold text-gray-400 uppercase tracking-wider text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-glass-border">
                                {% for app in applications %}
                                <tr class="group hover:bg-white/5 transition-colors duration-300">
                                    <td class="py-4 px-6">
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-peacock to-electric flex items-center justify-center text-xs font-bold text-white">
                                                {{ app.full_name[0] }}
                                            </div>
                                            <span class="font-medium text-white group-hover:text-electric transition-colors">{{ app.full_name }}</span>
                                        </div>
                                    </td>
                                    <td class="py-4 px-6 text-gray-300 font-mono text-sm">{{ app.id_proof_number }}</td>
                                    <td class="py-4 px-6 font-mono text-sm">
                                        {% if app.epic_number %}
                                            <span class="text-emerald font-bold">{{ app.epic_number }}</span>
                                        {% else %}
                                            <span class="text-gray-600">-</span>
                                        {% endif %}
                                    </td>
                                    <td class="py-4 px-6">
                                        {% if app.status == 'Pending' %}
                                            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-electric/10 text-electric border border-electric/20 animate-pulse-slow">
                                                <span class="w-1.5 h-1.5 rounded-full bg-electric"></span> Pending
                                            </span>
                                        {% elif app.status == 'Approved' %}
                                            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-emerald/10 text-emerald border border-emerald/20 shadow-glow-emerald">
                                                <span class="w-1.5 h-1.5 rounded-full bg-emerald"></span> Approved
                                            </span>
                                        {% else %}
                                            <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium bg-red-500/10 text-red-400 border border-red-500/20">
                                                <span class="w-1.5 h-1.5 rounded-full bg-red-500"></span> Rejected
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="py-4 px-6 text-gray-400 text-sm">{{ app.submitted_at.strftime('%Y-%m-%d') }}</td>
                                    <td class="py-4 px-6 text-right">
                                        <a href="{{ url_for('admin.view_application', app_id=app._id) }}" class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-white/5 hover:bg-electric hover:text-white transition-all duration-300 group-hover:scale-110">
                                            <i class="fas fa-chevron-right text-xs"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    {% if not applications %}
                    <div class="p-12 text-center text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-4 opacity-50"></i>
                        <p>No applications found.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Data from Backend
    const dailyStats = {{ daily_stats | tojson }};
    const appStats = {{ stats | tojson }};
    
    // Process Daily Data
    const dailyLabels = dailyStats.map(item => item._id);
    const dailyCounts = dailyStats.map(item => item.count);
    
    // Chart Config Common
    Chart.defaults.color = '#9ca3af';
    Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
    Chart.defaults.font.family = "'Inter', sans-serif";
    
    // Daily Registrations Chart
    const ctxDaily = document.getElementById('dailyChart').getContext('2d');
    
    // Premium Gradient
    const gradientDaily = ctxDaily.createLinearGradient(0, 0, 0, 300);
    gradientDaily.addColorStop(0, 'rgba(0, 243, 255, 0.15)');
    gradientDaily.addColorStop(1, 'rgba(0, 243, 255, 0)');

    new Chart(ctxDaily, {
        type: 'line',
        data: {
            labels: dailyLabels,
            datasets: [{
                label: 'Registrations',
                data: dailyCounts,
                borderColor: '#00f3ff', // electric
                backgroundColor: gradientDaily,
                borderWidth: 2,
                tension: 0.3, // Smooth but accurate
                fill: true,
                pointBackgroundColor: '#111827', // Dark center
                pointBorderColor: '#00f3ff',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6,
                pointHoverBackgroundColor: '#00f3ff',
                pointHoverBorderColor: '#fff',
                pointHitRadius: 20
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            layout: {
                padding: { top: 10, bottom: 10, left: 0, right: 10 }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    enabled: true,
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(17, 24, 39, 0.95)',
                    titleColor: '#9ca3af',
                    titleFont: { size: 11, weight: 500 },
                    bodyColor: '#fff',
                    bodyFont: { size: 14, weight: 700, family: "'Inter', sans-serif" },
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 1,
                    padding: 12,
                    cornerRadius: 8,
                    displayColors: false,
                    yAlign: 'bottom', // Tooltip above point
                    caretPadding: 15,
                    callbacks: {
                        title: function(context) {
                            const dateStr = context[0].label;
                            const date = new Date(dateStr);
                            // Fallback if date parsing fails
                            if (isNaN(date.getTime())) return dateStr;
                            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        },
                        label: function(context) {
                            return context.parsed.y + ' Registrations';
                        }
                    }
                }
            },
            scales: {
                y: { 
                    beginAtZero: true, 
                    grid: { 
                        color: 'rgba(255, 255, 255, 0.03)', 
                        drawBorder: false,
                    },
                    ticks: { 
                        color: '#6b7280',
                        font: { size: 11 },
                        padding: 10,
                        maxTicksLimit: 5
                    },
                    border: { display: false }
                },
                x: { 
                    grid: { display: false, drawBorder: false },
                    ticks: { 
                        color: '#6b7280',
                        font: { size: 11 },
                        maxRotation: 0,
                        minRotation: 0,
                        maxTicksLimit: 7, // Fewer labels (every 2-3 days approx)
                        autoSkip: true,
                        padding: 10,
                        callback: function(val, index) {
                            const label = this.getLabelForValue(val);
                            const date = new Date(label);
                            if (isNaN(date.getTime())) return label;
                            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                        }
                    },
                    border: { display: false }
                }
            }
        }
    });
    
    // Application Status Chart (Approved vs Rejected)
    const ctxStatus = document.getElementById('statusChart').getContext('2d');
    
    new Chart(ctxStatus, {
        type: 'doughnut',
        data: {
            labels: ['Approved', 'Rejected', 'Pending'],
            datasets: [{
                data: [appStats.approved || 0, appStats.rejected || 0, appStats.pending || 0],
                backgroundColor: [
                    '#10B981', // Emerald-500 (Approved)
                    '#EF4444', // Red-500 (Rejected)
                    '#00f3ff'  // Electric (Pending)
                ],
                borderWidth: 0,
                borderRadius: 5,
                spacing: 2,
                hoverOffset: 10,
                hoverBorderColor: '#fff',
                hoverBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '75%', // Thinner ring for elegance
            animation: {
                animateScale: true,
                animateRotate: true
            },
            plugins: {
                legend: { display: false }, // Using custom HTML legend
                tooltip: {
                    backgroundColor: 'rgba(17, 24, 39, 0.95)',
                    titleColor: '#fff',
                    bodyColor: '#fff',
                    borderColor: 'rgba(255, 255, 255, 0.1)',
                    borderWidth: 1,
                    padding: 12,
                    cornerRadius: 12,
                    displayColors: true,
                    boxPadding: 6,
                    callbacks: {
                        label: function(context) {
                            const value = context.raw;
                            const total = appStats.total || 0;
                            const percentage = total > 0 ? Math.round((value / total) * 100) + '%' : '0%';
                            return ` ${context.label}: ${value} (${percentage})`;
                        }
                    }
                }
            }
        }
    });
</script>
{% endblock %}
