{% extends "base.html" %}

{% block content %}
<div class="min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8 relative z-10">
    
    <!-- Back Button -->
    <div class="max-w-7xl mx-auto mb-6">
        <button onclick="window.history.back()" class="inline-flex items-center text-gray-400 hover:text-electric transition-colors group">
            <i class="fas fa-arrow-left mr-2 transform group-hover:-translate-x-1 transition-transform"></i>
            <span class="font-medium">Back to Dashboard</span>
        </button>
    </div>

    <!-- Header -->
    <div class="max-w-4xl mx-auto text-center mb-10">
        <h1 class="text-4xl font-display font-bold text-white mb-3">Search Your Name in Voter List</h1>
        <p class="text-lg text-gray-400">Enter your details to find your polling station and voter information.</p>
    </div>

    <!-- Search Box -->
    <div class="max-w-4xl mx-auto mb-12">
        <div class="glass-panel p-6 rounded-2xl border border-white/10 shadow-glow-sm bg-dark/80 backdrop-blur-md transition-all">
            
            <!-- Search Type Toggle (Premium Glassmorphism) -->
            <div class="flex justify-center mb-10">
                <div class="relative inline-flex bg-black/40 backdrop-blur-xl rounded-full p-1.5 border border-white/10 shadow-[inset_0_2px_10px_rgba(0,0,0,0.5)] group hover:border-white/20 transition-all duration-300">
                    <!-- Sliding Glider -->
                    <div id="toggleGlider" class="absolute top-1.5 left-1.5 bottom-1.5 w-64 bg-gradient-to-r from-electric to-blue-600 shadow-[0_0_20px_rgba(0,180,255,0.4)] rounded-full transition-transform duration-500 cubic-bezier(0.4, 0, 0.2, 1) border border-white/20 z-0">
                        <div class="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent rounded-full opacity-50"></div>
                    </div>

                    <!-- Buttons -->
                    <button onclick="toggleSearchType('details')" id="btnDetails" class="relative z-10 w-64 py-2.5 rounded-full text-sm font-display font-bold transition-colors duration-300 text-white tracking-wide flex items-center justify-center gap-2">
                        <i class="fas fa-user-edit text-lg"></i>
                        Search by Details
                    </button>
                    <button onclick="toggleSearchType('epic')" id="btnEpic" class="relative z-10 w-64 py-2.5 rounded-full text-sm font-display font-bold transition-colors duration-300 text-gray-400 hover:text-white tracking-wide flex items-center justify-center gap-2">
                        <i class="fas fa-id-card text-lg"></i>
                        Search by EPIC No.
                    </button>
                </div>
            </div>

            <!-- Search Form: Details -->
            <div id="searchByDetails" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="col-span-1 md:col-span-3 lg:col-span-1">
                    <label class="block text-xs text-gray-400 uppercase tracking-wider mb-2">Full Name</label>
                    <input type="text" id="nameInput" placeholder="Enter Full Name" 
                           class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-electric focus:ring-1 focus:ring-electric outline-none transition-all">
                </div>
                <div>
                    <label class="block text-xs text-gray-400 uppercase tracking-wider mb-2">Age</label>
                    <input type="number" id="ageInput" placeholder="Enter Age" 
                           class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-electric focus:ring-1 focus:ring-electric outline-none transition-all">
                </div>
                <div>
                    <label class="block text-xs text-gray-400 uppercase tracking-wider mb-2">State</label>
                    <select id="stateInput" class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-electric focus:ring-1 focus:ring-electric outline-none transition-all">
                        <option value="" class="bg-dark">Select State</option>
                        <option value="Andhra Pradesh" class="bg-dark">Andhra Pradesh</option>
                        <option value="Arunachal Pradesh" class="bg-dark">Arunachal Pradesh</option>
                        <option value="Assam" class="bg-dark">Assam</option>
                        <option value="Bihar" class="bg-dark">Bihar</option>
                        <option value="Chhattisgarh" class="bg-dark">Chhattisgarh</option>
                        <option value="Delhi" class="bg-dark">Delhi</option>
                        <option value="Goa" class="bg-dark">Goa</option>
                        <option value="Gujarat" class="bg-dark">Gujarat</option>
                        <option value="Haryana" class="bg-dark">Haryana</option>
                        <option value="Himachal Pradesh" class="bg-dark">Himachal Pradesh</option>
                        <option value="Jharkhand" class="bg-dark">Jharkhand</option>
                        <option value="Karnataka" class="bg-dark">Karnataka</option>
                        <option value="Kerala" class="bg-dark">Kerala</option>
                        <option value="Madhya Pradesh" class="bg-dark">Madhya Pradesh</option>
                        <option value="Maharashtra" class="bg-dark">Maharashtra</option>
                        <option value="Manipur" class="bg-dark">Manipur</option>
                        <option value="Meghalaya" class="bg-dark">Meghalaya</option>
                        <option value="Mizoram" class="bg-dark">Mizoram</option>
                        <option value="Nagaland" class="bg-dark">Nagaland</option>
                        <option value="Odisha" class="bg-dark">Odisha</option>
                        <option value="Punjab" class="bg-dark">Punjab</option>
                        <option value="Rajasthan" class="bg-dark">Rajasthan</option>
                        <option value="Sikkim" class="bg-dark">Sikkim</option>
                        <option value="Tamil Nadu" class="bg-dark">Tamil Nadu</option>
                        <option value="Telangana" class="bg-dark">Telangana</option>
                        <option value="Tripura" class="bg-dark">Tripura</option>
                        <option value="Uttar Pradesh" class="bg-dark">Uttar Pradesh</option>
                        <option value="Uttarakhand" class="bg-dark">Uttarakhand</option>
                        <option value="West Bengal" class="bg-dark">West Bengal</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 uppercase tracking-wider mb-2">District</label>
                    <input type="text" id="districtInput" placeholder="Enter District" 
                           class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-electric focus:ring-1 focus:ring-electric outline-none transition-all">
                </div>
                <div>
                    <label class="block text-xs text-gray-400 uppercase tracking-wider mb-2">Assembly Constituency</label>
                    <input type="text" id="assemblyInput" placeholder="Optional" 
                           class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-electric focus:ring-1 focus:ring-electric outline-none transition-all">
                </div>
                 <div class="flex items-end">
                    <button type="button" id="btnSearchDetails" onclick="performSearch()" class="w-full bg-electric hover:bg-blue-400 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg hover:shadow-glow flex items-center justify-center gap-2">
                        <i class="fas fa-search"></i> Search Records
                    </button>
                </div>
            </div>

            <!-- Search Form: EPIC -->
            <div id="searchByEpic" class="hidden flex gap-4">
                 <div class="flex-1">
                    <label class="block text-xs text-gray-400 uppercase tracking-wider mb-2">EPIC Number</label>
                    <input type="text" id="epicInput" placeholder="Enter EPIC Number (e.g., ABC1234567)" 
                           class="w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-electric focus:ring-1 focus:ring-electric outline-none transition-all"
                           onkeypress="if(event.key === 'Enter') performSearch()">
                </div>
                <div class="flex items-end">
                    <button type="button" onclick="performSearch()" class="w-full bg-electric hover:bg-blue-400 text-white font-bold py-3 px-8 rounded-xl transition-all shadow-lg hover:shadow-glow flex items-center justify-center gap-2">
                        <i class="fas fa-search"></i> Search Records
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="hidden text-center py-12">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-electric mb-4"></div>
        <p class="text-gray-400 animate-pulse">Searching electoral records...</p>
    </div>

    <!-- Results Section -->
    <div id="resultsContainer" class="max-w-4xl mx-auto space-y-6 hidden">
        <!-- Results will be injected here -->
    </div>

    <!-- Empty State -->
    <div id="emptyState" class="hidden text-center py-12">
        <div class="w-24 h-24 bg-white/5 rounded-full flex items-center justify-center mx-auto mb-6 border border-white/10">
            <i class="fas fa-search-minus text-4xl text-gray-500"></i>
        </div>
        <h3 class="text-2xl font-bold text-white mb-2">Voter not found in voter list</h3>
        <p class="text-gray-400 max-w-md mx-auto">We couldn't find any voter matching your details. Please check the spelling or try searching with your EPIC Number.</p>
    </div>
</div>

<script>
    let currentSearchType = 'details';

    function toggleSearchType(type) {
        currentSearchType = type;
        
        const btnDetails = document.getElementById('btnDetails');
        const btnEpic = document.getElementById('btnEpic');
        const glider = document.getElementById('toggleGlider');
        const formDetails = document.getElementById('searchByDetails');
        const formEpic = document.getElementById('searchByEpic');

        if (type === 'details') {
            // Glider Animation
            if(glider) glider.style.transform = 'translateX(0)';
            
            // Text Colors
            btnDetails.classList.remove('text-gray-400');
            btnDetails.classList.add('text-white');
            
            btnEpic.classList.add('text-gray-400');
            btnEpic.classList.remove('text-white');
            
            // Form Visibility
            formDetails.classList.remove('hidden');
            formDetails.classList.add('grid');
            formEpic.classList.add('hidden');
            formEpic.classList.remove('flex');
        } else {
            // Glider Animation
            if(glider) glider.style.transform = 'translateX(100%)';
            
            // Text Colors
            btnEpic.classList.remove('text-gray-400');
            btnEpic.classList.add('text-white');
            
            btnDetails.classList.add('text-gray-400');
            btnDetails.classList.remove('text-white');
            
            // Form Visibility
            formEpic.classList.remove('hidden');
            formEpic.classList.add('flex');
            formDetails.classList.add('hidden');
            formDetails.classList.remove('grid');
        }
    }

    async function performSearch() {
        let queryParams = new URLSearchParams();

        if (currentSearchType === 'details') {
            const name = document.getElementById('nameInput').value.trim();
            const age = document.getElementById('ageInput').value.trim();
            const state = document.getElementById('stateInput').value;
            const district = document.getElementById('districtInput').value.trim();
            const assembly = document.getElementById('assemblyInput').value.trim();

            if (!name) {
                alert('Please enter at least a Full Name to search.');
                return;
            }

            queryParams.append('type', 'details');
            queryParams.append('name', name);
            if (age) queryParams.append('age', age);
            if (state) queryParams.append('state', state);
            if (district) queryParams.append('district', district);
            if (assembly) queryParams.append('assembly', assembly);

        } else {
            const epic = document.getElementById('epicInput').value.trim();
            if (!epic) {
                alert('Please enter an EPIC Number.');
                return;
            }
            queryParams.append('type', 'epic');
            queryParams.append('epic', epic);
        }

        // UI Updates
        const loading = document.getElementById('loadingState');
        const results = document.getElementById('resultsContainer');
        const empty = document.getElementById('emptyState');
        
        loading.classList.remove('hidden');
        results.classList.add('hidden');
        empty.classList.add('hidden');
        results.innerHTML = ''; // Clear previous

        try {
            const response = await fetch(`/voter/api/search?${queryParams.toString()}`);
            const data = await response.json();

            loading.classList.add('hidden');

            if (data.length > 0) {
                results.classList.remove('hidden');
                
                data.forEach(voter => {
                    const card = createVoterCard(voter);
                    results.appendChild(card);
                });
            } else {
                empty.classList.remove('hidden');
            }

        } catch (error) {
            console.error('Search failed:', error);
            loading.classList.add('hidden');
            alert('An error occurred while searching. Please try again.');
        }
    }

    function createVoterCard(voter) {
        const div = document.createElement('div');
        div.className = 'glass-panel rounded-2xl border border-white/10 overflow-hidden shadow-lg animate-fade-in-up';
        
        // Header Strip
        div.innerHTML = `
            <div class="bg-gradient-to-r from-peacock/50 to-electric/50 px-6 py-4 flex justify-between items-center border-b border-white/10">
                <div class="flex items-center gap-6">
                    <div class="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center overflow-hidden flex-shrink-0">
                        ${voter.photo_url ? 
                            `<img src="/voter/photo/${voter.photo_url}" class="w-full h-full object-cover" alt="Voter Photo">` : 
                            `<div class="flex flex-col items-center justify-center w-full h-full bg-gray-800 text-gray-400"><i class="fas fa-user text-xl mb-1"></i><span class="text-[8px] uppercase">N/A</span></div>`
                        }
                    </div>
                    <div>
                        <h3 class="text-white font-bold text-lg">Electoral Roll Entry</h3>
                        <p class="text-xs text-blue-100 uppercase tracking-wider">Verified Record</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-blue-200 uppercase tracking-wider">EPIC Number</div>
                    <div class="text-xl font-display font-bold text-white tracking-widest">${voter.epic_number || 'N/A'}</div>
                </div>
            </div>
            
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-y-6 gap-x-8">
                <!-- Personal Details -->
                <div class="col-span-1 md:col-span-2 pb-4 border-b border-white/5">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <div class="text-gray-400 text-xs uppercase tracking-wider mb-1">Voter Name</div>
                            <div class="text-white font-bold text-lg">${voter.full_name}</div>
                            <div class="text-gray-400 text-xs mt-1">Relative: ${voter.relative_name || 'N/A'}</div>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs uppercase tracking-wider mb-1">Age / Gender</div>
                            <div class="text-white font-bold text-lg">${voter.age} Yrs / ${voter.gender}</div>
                        </div>
                         <div>
                            <div class="text-gray-400 text-xs uppercase tracking-wider mb-1">Part No. / Serial No.</div>
                            <div class="text-white font-bold text-lg">
                                ${voter.part_number || 'N/A'} <span class="text-gray-500 text-sm mx-1">/</span> ${voter.serial_number || 'N/A'}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Constituency Details -->
                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-map-marked-alt text-electric text-sm"></i>
                        <span class="text-gray-400 text-xs uppercase tracking-wider">Assembly Constituency</span>
                    </div>
                    <div class="text-white font-medium pl-6">${voter.assembly_constituency}</div>
                </div>

                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-landmark text-electric text-sm"></i>
                        <span class="text-gray-400 text-xs uppercase tracking-wider">Parliamentary Constituency</span>
                    </div>
                    <div class="text-white font-medium pl-6">${voter.loksabha_constituency}</div>
                </div>

                <!-- Polling Station -->
                <div class="col-span-1 md:col-span-2 pt-4 border-t border-white/5">
                    <div class="flex items-start gap-3">
                        <div class="mt-1">
                            <i class="fas fa-vote-yea text-emerald-400"></i>
                        </div>
                        <div>
                            <div class="text-gray-400 text-xs uppercase tracking-wider mb-1">Polling Station</div>
                            <div class="text-white font-bold text-lg">${voter.polling_station || 'To be assigned'}</div>
                            <p class="text-gray-400 text-sm mt-1">${voter.polling_address || ''}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer Actions -->
            <div class="bg-white/5 px-6 py-3 flex justify-between items-center border-t border-white/10">
                <button onclick="window.location.href='/voter/print-slip/${voter.epic_number}'" class="text-sm text-electric hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-print"></i> Print Slip
                </button>
                <button class="text-sm text-gray-400 hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-share-alt"></i> Share
                </button>
            </div>
        `;
        return div;
    }

    document.addEventListener('DOMContentLoaded', function() {
        function initCustomSelect(nativeSelectId, placeholder, options = {}) {
            const nativeSelect = document.getElementById(nativeSelectId);
            if (!nativeSelect) return;

            // Hide native select
            nativeSelect.style.display = 'none';

            // Create Container
            const container = document.createElement('div');
            container.className = 'custom-select-container';
            nativeSelect.parentNode.insertBefore(container, nativeSelect);
            container.appendChild(nativeSelect); // Move native select inside for cleaner DOM

            // Create Trigger
            const trigger = document.createElement('div');
            trigger.className = 'custom-select-trigger';
            trigger.setAttribute('tabindex', '0'); // Enable keyboard focus
            
            // Determine initial text
            let initialText = placeholder;
            if (nativeSelect.selectedIndex >= 0 && nativeSelect.options[nativeSelect.selectedIndex].value) {
                initialText = nativeSelect.options[nativeSelect.selectedIndex].text;
                trigger.classList.add('has-value');
            }
            
            trigger.innerHTML = `<span>${initialText}</span><i class="fas fa-chevron-down"></i>`;
            container.appendChild(trigger);

            // Create Options Container
            const optionsContainer = document.createElement('div');
            optionsContainer.className = 'custom-options';
            container.appendChild(optionsContainer);

            let focusedIndex = -1;

            // Helper to toggle state
            function setOpen(isOpen) {
                if (isOpen) {
                    container.classList.add('is-active');
                    optionsContainer.classList.add('is-open');
                    trigger.classList.add('is-open');
                    
                    // Reset focus index based on selection
                    const selected = optionsContainer.querySelector('.custom-option.selected');
                    const allOptions = Array.from(optionsContainer.querySelectorAll('.custom-option'));
                    if (selected) {
                        focusedIndex = allOptions.indexOf(selected);
                    } else {
                        focusedIndex = -1;
                    }
                    if (focusedIndex >= 0) highlightOption(focusedIndex);

                } else {
                    // Delay removing z-index to allow animation to finish
                    setTimeout(() => container.classList.remove('is-active'), 200);
                    optionsContainer.classList.remove('is-open');
                    trigger.classList.remove('is-open');
                    focusedIndex = -1;
                    clearHighlights();
                }
                if (options.onToggle) options.onToggle(isOpen);
            }

            function highlightOption(index) {
                const allOptions = optionsContainer.querySelectorAll('.custom-option');
                allOptions.forEach((opt, i) => {
                    if (i === index) {
                        opt.classList.add('focused');
                        opt.scrollIntoView({ block: 'nearest' });
                    } else {
                        opt.classList.remove('focused');
                    }
                });
            }

            function clearHighlights() {
                optionsContainer.querySelectorAll('.custom-option').forEach(o => o.classList.remove('focused'));
            }

            // Toggle Dropdown
            trigger.addEventListener('click', (e) => {
                e.stopPropagation();
                
                // Close other dropdowns
                document.querySelectorAll('.custom-options').forEach(opt => {
                    if (opt !== optionsContainer) {
                        opt.classList.remove('is-open');
                        opt.previousElementSibling.classList.remove('is-open');
                        const otherContainer = opt.closest('.custom-select-container');
                        if (otherContainer) otherContainer.classList.remove('is-active');
                    }
                });

                const willOpen = !optionsContainer.classList.contains('is-open');
                setOpen(willOpen);
            });

            // Keyboard Navigation
            trigger.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    if (optionsContainer.classList.contains('is-open')) {
                        if (focusedIndex >= 0) {
                            const allOptions = optionsContainer.querySelectorAll('.custom-option');
                            if (allOptions[focusedIndex]) allOptions[focusedIndex].click();
                        } else {
                            setOpen(false);
                        }
                    } else {
                        setOpen(true);
                    }
                } else if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (!optionsContainer.classList.contains('is-open')) setOpen(true);
                    const allOptions = optionsContainer.querySelectorAll('.custom-option');
                    if (focusedIndex < allOptions.length - 1) {
                        focusedIndex++;
                        highlightOption(focusedIndex);
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (!optionsContainer.classList.contains('is-open')) setOpen(true);
                    if (focusedIndex > 0) {
                        focusedIndex--;
                        highlightOption(focusedIndex);
                    }
                } else if (e.key === 'Escape') {
                    setOpen(false);
                    trigger.focus();
                } else if (e.key === 'Tab') {
                    setOpen(false);
                }
            });

            // Close when clicking outside
            document.addEventListener('click', (e) => {
                if (!container.contains(e.target)) {
                    if (optionsContainer.classList.contains('is-open')) {
                        setOpen(false);
                    }
                }
            });

            // Expose update function to refresh options from native select
            container.updateOptions = function() {
                optionsContainer.innerHTML = '';
                
                Array.from(nativeSelect.options).forEach(opt => {
                    if (opt.disabled || opt.value === "") return;

                    const customOption = document.createElement('div');
                    customOption.className = 'custom-option';
                    customOption.textContent = opt.text;
                    customOption.dataset.value = opt.value;
                    
                    if (opt.selected) {
                        customOption.classList.add('selected');
                    }

                    customOption.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // Update Native Select
                        nativeSelect.value = customOption.dataset.value;
                        
                        // Trigger Change Event on Native Select
                        const event = new Event('change', { bubbles: true });
                        nativeSelect.dispatchEvent(event);

                        // Update Trigger UI
                        trigger.querySelector('span').textContent = customOption.textContent;
                        trigger.classList.add('has-value');
                        
                        // Close Dropdown
                        setOpen(false);
                        
                        // Update Selection Styling
                        optionsContainer.querySelectorAll('.custom-option').forEach(o => o.classList.remove('selected'));
                        customOption.classList.add('selected');
                        trigger.focus();
                    });

                    // Mouse interaction
                    customOption.addEventListener('mouseenter', () => {
                        const allOptions = Array.from(optionsContainer.querySelectorAll('.custom-option'));
                        focusedIndex = allOptions.indexOf(customOption);
                        clearHighlights();
                        customOption.classList.add('focused');
                    });

                    optionsContainer.appendChild(customOption);
                });
            };

            // Initial population
            container.updateOptions();

            return container;
        }

        // Initialize UI wrappers
        initCustomSelect('stateInput', 'Select State', {
            onToggle: (isOpen) => {
                const btn = document.getElementById('btnSearchDetails');
                if (btn) {
                    // Use visibility: hidden to preserve layout space, avoiding jumps
                    btn.style.visibility = isOpen ? 'hidden' : 'visible';
                }
            }
        });
    });
</script>

<style>
    .animate-fade-in-up {
        animation: fadeInUp 0.5s ease-out forwards;
    }
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Custom Select Styles */
    .custom-select-container {
        position: relative;
        width: 100%;
    }

    .custom-select-container.is-active {
        z-index: 50;
    }

    .custom-select-trigger {
        width: 100%;
        background-color: rgba(255, 255, 255, 0.05); /* Match bg-white/5 */
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem; /* 12px */
        padding: 0.75rem 1rem; /* Match py-3 px-4 */
        color: #d1d5db; /* gray-300 */
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
        user-select: none;
    }

    .custom-select-trigger.has-value {
        color: white;
    }

    .custom-select-trigger:hover {
        background-color: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
    }

    .custom-select-trigger.is-open {
        border-color: #00f2ea; /* Electric Blue */
        box-shadow: 0 0 15px rgba(0, 242, 234, 0.15);
        background-color: #0F172A;
    }

    .custom-select-trigger i {
        transition: transform 0.3s ease;
        color: #6b7280;
    }

    .custom-select-trigger.is-open i {
        transform: rotate(180deg);
        color: #00f2ea;
    }

    .custom-options {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        right: 0;
        background-color: #0F172A; /* Slate 900 - Solid Background */
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        z-index: 100; /* High Z-Index */
        max-height: 300px;
        overflow-y: auto;
        overscroll-behavior: contain; /* Prevent scroll chaining */
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
        box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
    }

    .custom-options.is-open {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }

    .custom-option {
        padding: 12px 16px;
        color: #e2e8f0;
        cursor: pointer;
        transition: all 0.15s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 0.95rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.03);
    }
    
    .custom-option:last-child {
        border-bottom: none;
    }

    .custom-option:hover {
        background-color: rgba(0, 242, 234, 0.1); /* Electric Blue with opacity */
        color: #00f2ea;
        padding-left: 20px; /* Subtle shift */
    }

    .custom-option.selected {
        background-color: rgba(0, 242, 234, 0.15);
        color: white;
        font-weight: 500;
    }
    
    .custom-option.selected::after {
        content: '\f00c';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        color: #00f2ea;
        font-size: 0.8rem;
    }

    /* Custom Scrollbar - Slim & Minimal */
    .custom-options::-webkit-scrollbar {
        width: 6px;
    }

    .custom-options::-webkit-scrollbar-track {
        background: transparent;
    }

    .custom-options::-webkit-scrollbar-thumb {
        background: rgba(0, 242, 234, 0.2); /* Soft Electric Blue */
        border-radius: 10px;
        transition: background 0.2s ease;
    }

    .custom-options::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 242, 234, 0.5); /* Brighter on hover */
    }

    /* Firefox Scrollbar Support */
    .custom-options {
        scrollbar-width: thin;
        scrollbar-color: rgba(0, 242, 234, 0.2) transparent;
    }
</style>
{% endblock %}