{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-6 py-8">
    <!-- Header with Back Button -->
    <div class="flex justify-between items-center mb-8 animate-slide-in">
        <h2 class="font-display text-3xl font-bold text-white">
            <span class="text-electric">Application</span> Details
        </h2>
        <a href="{{ url_for('admin.dashboard') }}" 
           class="group flex items-center gap-2 px-5 py-2.5 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 text-gray-300 hover:text-white transition-all duration-300">
            <i class="fas fa-arrow-left group-hover:-translate-x-1 transition-transform"></i>
            <span>Back to Dashboard</span>
        </a>
    </div>

    <div class="max-w-4xl mx-auto">
        <!-- Main Application Card -->
        <div class="glass-panel p-8 rounded-3xl animate-slide-in" style="animation-delay: 0.1s;">
            <!-- Applicant Header -->
            <div class="flex items-start justify-between border-b border-white/10 pb-6 mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-2">{{ application.full_name }}</h1>
                    <div class="flex items-center gap-4 text-sm text-gray-400">
                        <span class="flex items-center gap-2">
                            <i class="fas fa-envelope text-electric"></i>
                            {{ application.email if application.email else 'Email not available' }}
                        </span>
                        <span class="w-1 h-1 rounded-full bg-gray-600"></span>
                        <span class="flex items-center gap-2">
                            <i class="fas fa-phone text-electric"></i>
                            {{ application.phone if application.phone else 'Phone not available' }}
                        </span>
                    </div>
                </div>
                
                <!-- Status Badge -->
                <div class="px-4 py-2 rounded-xl border backdrop-blur-md
                    {% if application.status == 'Approved' %}
                        bg-emerald/10 border-emerald/30 text-emerald
                    {% elif application.status == 'Rejected' %}
                        bg-red-500/10 border-red-500/30 text-red-400
                    {% else %}
                        bg-amber-500/10 border-amber-500/30 text-amber-500
                    {% endif %}">
                    <div class="flex items-center gap-2 font-medium">
                        {% if application.status == 'Approved' %}
                            <i class="fas fa-check-circle"></i> Approved
                        {% elif application.status == 'Rejected' %}
                            <i class="fas fa-times-circle"></i> Rejected
                        {% else %}
                            <i class="fas fa-clock"></i> Pending
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Details Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-semibold text-electric uppercase tracking-wider mb-1">Date of Birth</label>
                        <p class="text-lg text-white font-medium">
                            {% if application.dob is string %}
                                {{ application.dob }}
                            {% else %}
                                {{ application.dob.strftime('%Y-%m-%d') }}
                            {% endif %}
                        </p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-electric uppercase tracking-wider mb-1">Gender</label>
                        <p class="text-lg text-white font-medium">{{ application.gender }}</p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-electric uppercase tracking-wider mb-1">ID Proof Number</label>
                        <p class="text-lg text-white font-medium font-mono">{{ application.id_proof_number }}</p>
                    </div>
                    {% if application.epic_number %}
                    <div>
                        <label class="block text-xs font-semibold text-emerald uppercase tracking-wider mb-1">EPIC Number (Voter ID)</label>
                        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-emerald/10 border border-emerald/30 text-emerald font-mono font-bold text-lg">
                            <i class="fas fa-id-card"></i>
                            {{ application.epic_number }}
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-semibold text-electric uppercase tracking-wider mb-1">Address</label>
                        <p class="text-lg text-white font-medium leading-relaxed">{{ application.address }}</p>
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-electric uppercase tracking-wider mb-2">Submitted Document</label>
                        <a href="{{ url_for('admin.view_document', filename=application.document_path) }}" target="_blank" 
                           class="inline-flex items-center gap-3 px-5 py-3 rounded-xl bg-electric/10 border border-electric/30 text-electric hover:bg-electric/20 hover:scale-105 transition-all duration-300 group">
                            <i class="fas fa-file-alt text-xl"></i>
                            <span class="font-medium">View Document</span>
                            <i class="fas fa-external-link-alt text-xs opacity-50 group-hover:opacity-100"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Action Area -->
            <div class="border-t border-white/10 pt-8 mt-8">
                {% if application.status == 'Pending' %}
                    <h3 class="text-lg font-bold text-white mb-4">Actions</h3>
                    <div class="flex flex-wrap gap-4">
                        <form action="{{ url_for('admin.approve_application', app_id=application._id) }}" method="POST">
                            <button type="submit" class="px-6 py-3 rounded-xl bg-emerald/20 border border-emerald/50 text-emerald hover:bg-emerald hover:text-white hover:shadow-glow-emerald transition-all duration-300 font-medium flex items-center gap-2">
                                <i class="fas fa-check"></i> Approve Application
                            </button>
                        </form>
                        
                        <button onclick="openRejectModal()" class="px-6 py-3 rounded-xl bg-red-500/10 border border-red-500/30 text-red-400 hover:bg-red-500 hover:text-white hover:shadow-red-glow transition-all duration-300 font-medium flex items-center gap-2">
                            <i class="fas fa-times"></i> Reject Application
                        </button>
                    </div>
                {% elif application.status == 'Rejected' %}
                    <div class="p-4 rounded-xl bg-red-500/5 border border-red-500/20">
                        <h4 class="text-red-400 font-bold mb-2 flex items-center gap-2">
                            <i class="fas fa-exclamation-circle"></i> Rejection Reason
                        </h4>
                        <p class="text-gray-300">{{ application.rejection_reason }}</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Custom Glass Modal -->
<div id="rejectModal" class="fixed inset-0 z-50 hidden opacity-0 transition-opacity duration-300">
    <!-- Backdrop -->
    <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeRejectModal()"></div>
    
    <!-- Modal Content -->
    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-6">
        <div class="glass-panel rounded-3xl border border-white/10 shadow-2xl transform scale-95 transition-transform duration-300 bg-dark/90 backdrop-blur-xl" id="modalContent">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <h3 class="font-display text-2xl font-bold text-white">Reject Application</h3>
                <button onclick="closeRejectModal()" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:bg-white/10 hover:text-white transition-all">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form action="{{ url_for('admin.reject_application', app_id=application._id) }}" method="POST" class="p-6">
                <div class="mb-6">
                    <label for="reason" class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3">Reason for Rejection</label>
                    <textarea id="reason" name="reason" rows="4" required
                        class="w-full bg-white/5 border border-white/10 rounded-xl px-5 py-4 text-white placeholder-gray-500 focus:outline-none focus:border-red-500 focus:shadow-[0_0_20px_rgba(239,68,68,0.3)] transition-all resize-none"
                        placeholder="Please provide a specific reason..."></textarea>
                </div>
                
                <div class="flex justify-end gap-3 pt-2">
                    <button type="button" onclick="closeRejectModal()" 
                            class="px-6 py-3 rounded-xl bg-white/5 border border-white/10 text-gray-300 font-medium hover:bg-white/10 hover:text-white transition-all">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-6 py-3 rounded-xl bg-gradient-to-r from-red-500 to-rose-600 text-white font-bold shadow-lg shadow-red-500/20 hover:shadow-red-500/40 hover:scale-[1.02] transition-all">
                        Confirm Reject
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function openRejectModal() {
        const modal = document.getElementById('rejectModal');
        const content = document.getElementById('modalContent');
        
        modal.classList.remove('hidden');
        // Force reflow
        void modal.offsetWidth;
        
        modal.classList.remove('opacity-0');
        content.classList.remove('scale-95');
        content.classList.add('scale-100');
    }

    function closeRejectModal() {
        const modal = document.getElementById('rejectModal');
        const content = document.getElementById('modalContent');
        
        modal.classList.add('opacity-0');
        content.classList.remove('scale-100');
        content.classList.add('scale-95');
        
        setTimeout(() => {
            modal.classList.add('hidden');
        }, 300);
    }
</script>
{% endblock %}
